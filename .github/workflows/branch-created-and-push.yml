name: notify-branch-created

on:
  create:
  push:

jobs:
  slack-notify-created:
    runs-on: ubuntu-latest
    if: ${{ github.event_name=='create' && github.ref_type == 'branch' }}

    steps:
      - name: Set Slack message for branch create
        if: ${{ github.ref_type == 'branch' }}
        run: |
          REPO="${GITHUB_REPOSITORY}"
          BRANCH="${GITHUB_REF_NAME}"
          ACTOR="${GITHUB_ACTOR}"

          MESSAGE="[브런치 생성] ${ACTOR}님이 ${REPO}에서 ${BRANCH}를 생성했습니다"

          {
            echo "MESSAGE<<EOF"
            echo "${MESSAGE}"
            echo "EOF"
          } >> $GITHUB_ENV

      - name: Send Slack message
        if: ${{ env.MESSAGE != '' }}
        run: |
          echo "Send to Slack: ${MESSAGE}"

          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"${MESSAGE}\"}" \
          ${{ secrets.SLACK_WEBHOOK_URL }}

          
  slack-notify-push:
    runs-on: ubuntu-latest
    if: ${{ github.event_name=='push' }}

    steps:
      - name: Set Slack message for branch push
        if: ${{ github.ref_type == 'branch' }}
        run: |
          REPO="${GITHUB_REPOSITORY}"
          BRANCH="${GITHUB_REF_NAME}"
          ACTOR="${GITHUB_ACTOR}"

          MESSAGE="[브런치 수정] ${ACTOR}님이 ${REPO}에서 ${BRANCH}에 커밋을 푸시했습니다"

          {
            echo "MESSAGE<<EOF"
            echo "${MESSAGE}"
            echo "EOF"
          } >> $GITHUB_ENV

      - name: Send Slack message
        if: ${{ env.MESSAGE != '' }}
        run: |
          echo "Send to Slack: ${MESSAGE}"

          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"${MESSAGE}\"}" \
          ${{ secrets.SLACK_WEBHOOK_URL }}